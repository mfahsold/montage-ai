# Export CLI Quick Reference

## Installation Verification

```bash
# Test CLI works
./montage-ai.sh export-to-nle --help

# Test Python module
python3 -m montage_ai.export.cli --help
```

## Usage Examples

### Basic Export to OTIO Format
```bash
./montage-ai.sh export-to-nle \
  --manifest /data/output/manifest.json
```

### Export to Multiple Formats (Premiere + OTIO + Parameters)
```bash
./montage-ai.sh export-to-nle \
  --manifest /data/output/manifest.json \
  --formats otio premiere params_json \
  --project-name "My Music Video" \
  --output-dir /data/output/exports
```

### Export with Custom Resolution & FPS
```bash
./montage-ai.sh export-to-nle \
  --manifest /data/output/manifest.json \
  --fps 24.0 \
  --width 1920 \
  --height 1080 \
  --formats otio premiere
```

### Export with Editing Parameters Roundtrip
```bash
./montage-ai.sh export-to-nle \
  --manifest /data/output/manifest.json \
  --params /data/output/editing_parameters.json \
  --formats otio params_json
```

## Manifest Format

The manifest JSON (generated by montage render) should contain:
```json
{
  "project": "My Project",
  "fps": 30.0,
  "duration": 120.5,
  "clips": [
    {
      "source_path": "/data/input/clip1.mp4",
      "sequence_number": 1,
      "in_time": 0.0,
      "out_time": 5.0,
      "duration": 5.0,
      "applied_effects": {},
      "beat_markers": []
    }
  ]
}
```

## Python API

```python
from src.montage_ai.export.otio_builder import OTIOBuilder, TimelineClipInfo
from src.montage_ai.editing_parameters import EditingParameters

# Create builder
builder = OTIOBuilder(fps=30.0, video_width=1920, video_height=1080)

# Create timeline
timeline = builder.create_timeline("My Project")

# Add clip
clip_info = TimelineClipInfo(
    source_path="/data/input/clip.mp4",
    sequence_number=1,
    in_time=0.0,
    out_time=5.0,
    duration=5.0,
    applied_effects={"color_grading": {"preset": "cinematic"}},
    recommended_effects={}
)
clip = builder.add_clip(clip_info, EditingParameters())

# Export
builder.export_to_otio_json(Path("/data/output/timeline.otio"))
builder.export_to_premiere_xml(Path("/data/output/timeline.xml"))
```

## Supported Export Formats

| Format | Extension | Use Case | Status |
|--------|-----------|----------|--------|
| **OTIO** | `.otio` | Canonical format, preserves all metadata | ✅ Full Support |
| **Premiere XML** | `.xml` | Adobe Premiere Pro roundtrip | ✅ Full Support |
| **AAF** | `.aaf` | Avid Media Composer | ✅ Full Support |
| **Parameters JSON** | `.json` | EditingParameters serialization | ✅ Full Support |
| **EDL** | `.edl` | Legacy (plugin not available in current OTIO) | ⚠️ Limited |

## Troubleshooting

### "Cannot find manifest"
```bash
# Ensure manifest path is correct
ls -la /data/output/manifest.json

# Use absolute path
./montage-ai.sh export-to-nle --manifest $(pwd)/manifest.json
```

### "opentimelineio not installed"
```bash
# Install via requirements
pip install opentimelineio
```

### Export fails silently
```bash
# Use verbose flag for detailed logs
./montage-ai.sh export-to-nle \
  --manifest /data/output/manifest.json \
  --verbose
```

## Integration with Render Pipeline

Once `MontageBuilder.process()` generates manifest:

```bash
# 1. Render montage
./montage-ai.sh run dynamic \
  --output-dir /data/output

# 2. Export to NLE
./montage-ai.sh export-to-nle \
  --manifest /data/output/manifest.json \
  --formats otio premiere params_json

# 3. Open in NLE
# Adobe Premiere: File → Open → timeline.xml
# OTIO tools: otioview timeline.otio
```

## Architecture Diagram

```
Montage Render
    ↓
manifest.json (clips, timings, beats)
    ↓
export-to-nle CLI
    ├── Load manifest
    ├── Create OTIO timeline
    ├── Add clips + metadata
    └── Export to formats
        ├── timeline.otio (canonical)
        ├── timeline.xml (Premiere)
        ├── timeline.aaf (Avid)
        └── parameters.json (roundtrip)
    ↓
NLE (Adobe Premiere, Avid, DaVinci Resolve)
```

---

**Status:** ✅ All components working and verified  
**Last Updated:** 2025-01-20  
**Documentation:** See [AI_DIRECTOR_PARAMETER_TUNING.md](docs/AI_DIRECTOR_PARAMETER_TUNING.md)
