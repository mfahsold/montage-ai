# =============================================================================
# Deployment Configuration - Centralized for all environments
# =============================================================================
# This file is sourced by deployment scripts and Kubernetes manifests.
# Copy and customize for your environment.
# =============================================================================

# Registry Configuration
# For ghcr.io: REGISTRY_HOST=ghcr.io/mfahsold REGISTRY_PORT=""
# For local registry: REGISTRY_HOST=registry.local REGISTRY_PORT=5000
REGISTRY_HOST="${REGISTRY_HOST:-registry.example.com}"
REGISTRY_PORT="${REGISTRY_PORT:-5000}"
REGISTRY_URL="${REGISTRY_HOST}${REGISTRY_PORT:+:${REGISTRY_PORT}}"

# Image Configuration
IMAGE_NAME="${IMAGE_NAME:-montage-ai}"
IMAGE_TAG="${IMAGE_TAG:-latest-amd64}"
IMAGE_FULL="${REGISTRY_URL}/${IMAGE_NAME}:${IMAGE_TAG}"

# UV (Astral) Configuration
# Version of uv used for CI and local development. Pin for reproducible builds.
UV_VERSION="${UV_VERSION:-0.9.24}"
# Official uv GHCR image (use in Docker builds if desired)
UV_IMAGE="${UV_IMAGE:-ghcr.io/astral-sh/uv:${UV_VERSION}}"
# UV cache directory (used for CI and local caching)
UV_CACHE_DIR="${UV_CACHE_DIR:-$HOME/.cache/uv}"

# Kubernetes Configuration
CLUSTER_NAMESPACE="${CLUSTER_NAMESPACE:-montage-ai}"
CLUSTER_API_SERVER="${CLUSTER_API_SERVER:-https://kubernetes.default.svc:6443}"

# Domain Configuration
APP_DOMAIN="${APP_DOMAIN:-montage-ai.example.com}"
TLS_SECRET="${TLS_SECRET:-montage-ai-tls}"

# Application Configuration
APP_NAME="${APP_NAME:-montage-ai}"
APP_LABEL="${APP_LABEL:-app=montage-ai}"

# Staging / Autoscaling defaults (can be overridden per-overlay or env)
# - sensible, conservative defaults to avoid hardcoding values in manifests
WORKER_MIN_REPLICAS="${WORKER_MIN_REPLICAS:-1}"
WORKER_MAX_REPLICAS="${WORKER_MAX_REPLICAS:-8}"
WORKER_QUEUE_SCALE_THRESHOLD="${WORKER_QUEUE_SCALE_THRESHOLD:-10}"
MAX_CONCURRENT_JOBS_DEFAULT="${MAX_CONCURRENT_JOBS_DEFAULT:-2}"
MAX_PARALLEL_JOBS_DEFAULT="${MAX_PARALLEL_JOBS_DEFAULT:-2}"

# Data Paths (Container internal)
DATA_INPUT_DIR="${DATA_INPUT_DIR:-/data/input}"
DATA_OUTPUT_DIR="${DATA_OUTPUT_DIR:-/data/output}"
DATA_MUSIC_DIR="${DATA_MUSIC_DIR:-/data/music}"
DATA_ASSETS_DIR="${DATA_ASSETS_DIR:-/data/assets}"
DATA_LUTS_DIR="${DATA_LUTS_DIR:-/data/luts}"

# Storage Configuration
STORAGE_CLASS="${STORAGE_CLASS:-nfs-client}"
PVC_NAME="${PVC_NAME:-montage-ai-data}"
PVC_SIZE="${PVC_SIZE:-100Gi}"

# Service Configuration
SERVICE_PORT="${SERVICE_PORT:-5000}"
SERVICE_TARGET_PORT="${SERVICE_TARGET_PORT:-5000}"
SERVICE_NAME="${SERVICE_NAME:-montage-ai-web}"

# Ingress Configuration
INGRESS_NAME="${INGRESS_NAME:-montage-ai-web}"
INGRESS_MAX_REQUEST_BODY="${INGRESS_MAX_REQUEST_BODY:-5000000000}"

# Backend API Configuration
BACKEND_API_URL="${BACKEND_API_URL:-http://localhost:5000}"

# Testing Configuration
TEST_BASE_URL="${TEST_BASE_URL:-http://localhost:5000}"
TEST_UPLOAD_URL="${TEST_UPLOAD_URL:-http://localhost:5001/api/upload}"

# Preview fast-path defaults (tunable)
PREVIEW_MAX_INPUT_SIZE_MB="${PREVIEW_MAX_INPUT_SIZE_MB:-200}"
PREVIEW_MAX_FILES="${PREVIEW_MAX_FILES:-3}"

# Proxy cache policy (TTL seconds, max bytes)
PROXY_CACHE_TTL_SECONDS="${PROXY_CACHE_TTL_SECONDS:-86400}"
PROXY_CACHE_MAX_BYTES="${PROXY_CACHE_MAX_BYTES:-1073741824}"
PROXY_CACHE_MIN_AGE_SECONDS="${PROXY_CACHE_MIN_AGE_SECONDS:-60}"

# Deployment Strategy
DEPLOYMENT_STRATEGY="${DEPLOYMENT_STRATEGY:-RollingUpdate}"
DEPLOYMENT_MIN_READY_SECONDS="${DEPLOYMENT_MIN_READY_SECONDS:-0}"

# Resource Limits
MEMORY_LIMIT="${MEMORY_LIMIT:-4Gi}"
MEMORY_REQUEST="${MEMORY_REQUEST:-2Gi}"
CPU_LIMIT="${CPU_LIMIT:-2000m}"
CPU_REQUEST="${CPU_REQUEST:-500m}"

# Logging Configuration
LOG_LEVEL="${LOG_LEVEL:-INFO}"
