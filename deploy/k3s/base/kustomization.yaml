apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: montage-ai

resources:
  - deployment.yaml
  - cgpu-server.yaml
  - service-ingress.yaml
  - pvc.yaml
  - namespace.yaml
  - network-policy.yaml
  - job.yaml

# =============================================================================
# Image Configuration
# =============================================================================
# Default: ghcr.io/mfahsold/montage-ai (GitHub Container Registry)
# For self-hosted registries, use an overlay or edit this file.
#
# Update tag after build:
#   kustomize edit set image ghcr.io/mfahsold/montage-ai=ghcr.io/mfahsold/montage-ai:v1.0.0
#
# For local/private registries, create an overlay:
#   overlays/local/kustomization.yaml:
#     images:
#       - name: ghcr.io/mfahsold/montage-ai
#         newName: your-registry:30500/montage-ai
#         newTag: latest
# =============================================================================
# Use the helper script to set images across overlays:
#   ./scripts/kustomize-set-image.sh <image>
# or the Makefile target: `make cluster-deploy` which runs the script for you.

# ConfigMap for deployment settings (overlays can patch)
configMapGenerator:
  - name: montage-ai-config
    behavior: create
    literals:
      - CUT_STYLE=dynamic
      - STABILIZE=false
      - UPSCALE=false
      - ENHANCE=false
      - OLLAMA_HOST=http://localhost:11434
      - CGPU_ENABLED=true
      - CGPU_HOST=cgpu-server
      - CGPU_PORT=8080
      - PREVIEW_MAX_INPUT_SIZE_MB=10000
      - PREVIEW_MAX_FILES=50

  - name: montage-ai-script
    files:
      - montage-ai.sh=../../../montage-ai.sh
  - name: montage-ai-patch-segment-writer
    files:
      - segment_writer.py=../../../src/montage_ai/segment_writer.py
  - name: montage-ai-patch-clip-processor
    files:
      - clip_processor.py=../../../src/montage_ai/core/clip_processor.py
  - name: montage-ai-patch-analysis-engine
    files:
      - analysis_engine.py=../../../src/montage_ai/core/analysis_engine.py
  - name: montage-ai-patch-hardware
    files:
      - hardware.py=../../../src/montage_ai/core/hardware.py
  - name: montage-ai-patch-creative-director
    files:
      - creative_director.py=../../../src/montage_ai/creative_director.py
  - name: montage-ai-patch-proxy-generator
    files:
      - proxy_generator.py=../../../src/montage_ai/proxy_generator.py
