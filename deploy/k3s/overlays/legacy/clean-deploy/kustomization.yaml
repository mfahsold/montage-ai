apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
# Clean/dev overlay: ephemeral volumes (emptyDir), dev guards enabled
resources:
  - ../../../base
  - keda-montage-worker.yaml

patchesStrategicMerge:
  - patch-deployment-dev.yaml
  - ingress-fallback.yaml

configMapGenerator:
  - name: clean-deploy-config
    literals:
      - ENABLE_DEV_ENDPOINTS=true
      - RUN_SCALE_TESTS=1

namespace: montage-ai

replacements:
  - source:
      kind: ConfigMap
      name: cluster-config
      fieldPath: data.MONTAGE_HOSTNAME
    targets:
      - select:
          kind: Ingress
          name: montage-ai-web-clean-fallback
        fieldPaths:
          - spec.rules.0.host
