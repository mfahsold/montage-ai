<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montage AI - Creative Console</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='elegant.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='ui-utils.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <svg class="logo-svg" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Film reel outer ring -->
                    <circle cx="32" cy="32" r="28" stroke="currentColor" stroke-width="4" fill="none"/>
                    <!-- Inner film holes -->
                    <circle cx="32" cy="14" r="4" fill="currentColor"/>
                    <circle cx="32" cy="50" r="4" fill="currentColor"/>
                    <circle cx="14" cy="32" r="4" fill="currentColor"/>
                    <circle cx="50" cy="32" r="4" fill="currentColor"/>
                    <!-- AI brain/circuit in center -->
                    <rect x="24" y="24" width="16" height="16" fill="currentColor"/>
                </svg>
                <div class="logo-text">
                    <h1>Montage<span class="logo-ai">AI</span></h1>
                    <p class="subtitle">// AUTOMATED_EDITING_SYSTEM // v{{ version }}</p>
                </div>
            </div>
            <div class="version-badge">SYS.READY</div>
        </header>

        <!-- Progress Bar (Hidden by default) -->
        <div id="global-progress-bar" class="progress-container progress-hidden mb-15">
            <div class="progress-header progress-header-row">
                <span id="progress-label">PROCESSING...</span>
                <span id="progress-eta">ETA: --:--</span>
            </div>
            <div class="progress-track">
                <div id="progress-fill" class="progress-fill progress-fill-default"></div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="nav-bar voxel-card nav-inline">
            <a href="/" class="btn btn-primary link-clean">üè† Montage Wizard</a>
            <a href="/transcript" class="btn btn-secondary link-clean">üìù Transcript Editor</a>
            <a href="/shorts" class="btn btn-secondary link-clean">üì± Shorts Studio</a>
        </nav>

        <section class="voxel-card info-card">
            <h2>// SYSTEM_OVERVIEW</h2>
            <div class="steps-grid">
                <div class="step-item">
                    <div class="step-number">01</div>
                    <h3>Upload Media</h3>
                    <p>Drop your raw video clips and a music track. Accepted: MP4/MOV (video), MP3/WAV (audio).</p>
                </div>
                <div class="step-item">
                    <div class="step-number">02</div>
                    <h3>Pick Style</h3>
                    <p>Select a cinematic preset or write a short prompt. Defaults are tuned for most use cases.</p>
                </div>
                <div class="step-item">
                    <div class="step-number">03</div>
                    <h3>Review Output</h3>
                    <p>Monitor progress, then download MP4 (and timeline if enabled). Adjust settings and iterate.</p>
                </div>
            </div>
        </section>

        <section class="voxel-card info-card transparency-card">
            <h2>// RESPONSIBLE_AI // TRANSPARENCY</h2>
            <div id="transparencyContent" class="transparency-grid">
                <div class="helper">Loading transparency details...</div>
            </div>
            <div class="helper">Docs: <a href="https://github.com/codeai/montage-ai/blob/main/docs/responsible_ai.md" target="_blank" rel="noopener" class="link-clean">docs/responsible_ai.md</a></div>
        </section>

        <div class="layout-grid">
            <!-- Panel 1: Media Intake -->
            <section class="voxel-card">
                <div class="section-heading">
                    <h2>MEDIA // INPUTS</h2>
                    <div class="pill">Accepted: mp4 ¬∑ mov ¬∑ mp3 ¬∑ wav</div>
                </div>
                <div class="upload-area">
                    <div class="upload-box">
                        <h3>Video Clips</h3>
                        <p class="helper">Drop multiple clips. Longer clips are auto-segmented.</p>
                        <input type="file" id="videoUpload" accept="video/*" multiple class="hidden" aria-label="Select video clips">
                        <button onclick="document.getElementById('videoUpload').click()" class="voxel-btn">Select Videos</button>
                        <div id="videoList" class="file-list"></div>
                    </div>
                    <div class="upload-box">
                        <h3>Music Track</h3>
                        <p class="helper">One track drives beat sync. MP3/WAV recommended.</p>
                        <input type="file" id="musicUpload" accept="audio/*" class="hidden" aria-label="Select music track">
                        <button onclick="document.getElementById('musicUpload').click()" class="voxel-btn">Select Music</button>
                        <div id="musicList" class="file-list"></div>
                    </div>
                </div>
                <div class="text-center flex-column flex-center gap-05">
                    <button onclick="refreshFiles()" class="voxel-btn">‚ü≥ Refresh Library</button>
                    <label class="checkbox-inline ml-0">
                        <input type="checkbox" id="autoPreview" checked>
                        <span>Auto-generate 360p preview after upload</span>
                    </label>
                </div>
            </section>

            <!-- Panel 2: Style & Intent -->
            <section class="voxel-card">
                <div class="section-heading">
                    <h2>STYLE // INTENT</h2>
                    <div class="badge speed">Default: Dynamic</div>
                </div>
                <div class="form-group">
                    <label for="style">Style Preset</label>
                    <select id="style" class="voxel-select">
                        <option value="dynamic">Dynamic ‚Äî Position-aware pacing</option>
                        <option value="hitchcock">Hitchcock ‚Äî Suspense / slow build</option>
                        <option value="mtv">MTV ‚Äî Rapid fire cuts</option>
                        <option value="action">Action ‚Äî High energy</option>
                        <option value="documentary">Documentary ‚Äî Observational</option>
                        <option value="minimalist">Minimalist ‚Äî Long takes</option>
                        <option value="wes_anderson">Wes Anderson ‚Äî Symmetric / stylized</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="prompt">Creative Director Prompt</label>
                    <input type="text" id="prompt" class="voxel-input" placeholder="e.g., make it feel like a 90s skateboard video">
                    <div class="helper">Natural language overrides preset pacing/energy. Click a chip to use it.</div>
                </div>
                <div class="chips">
                    <span class="chip">Fast social cut</span>
                    <span class="chip">Cinematic vlog</span>
                    <span class="chip">Travel montage</span>
                    <span class="chip">Product hype</span>
                    <span class="chip">Emotional journey</span>
                    <span class="chip">High energy action</span>
                </div>
                <div id="storyArc-container" class="form-group mt-1">
                    <!-- Rendered by JS -->
                </div>
            </section>

            <!-- Panel 3: Quality & Delivery -->
            <section class="voxel-card">
                <div class="section-heading">
                    <h2>QUALITY // DELIVERY</h2>
                    <div class="badge quality">Balanced defaults</div>
                </div>

                <div id="qualityProfile-container" class="form-group">
                    <!-- Rendered by JS -->
                </div>

                <div class="form-group">
                    <label for="targetDuration">Target Duration <span id="durationValue">Auto</span></label>
                    <input type="range" id="targetDuration" min="0" max="300" step="10" value="0" aria-label="Target duration seconds">
                    <div class="helper">0 = match music length. Adjust to trim or shorten.</div>
                </div>

                <div class="form-group">
                    <label>Music Trim (seconds)</label>
                    <div class="flex-row gap-10">
                        <div class="flex-1">
                            <label for="musicStart" class="label-small">Start</label>
                            <input type="number" id="musicStart" class="voxel-input" value="0" min="0" step="0.1">
                        </div>
                        <div class="flex-1">
                            <label for="musicEnd" class="label-small">End (optional)</label>
                            <input type="number" id="musicEnd" class="voxel-input" placeholder="Auto" min="0" step="0.1">
                        </div>
                    </div>
                    <div class="helper">Auto-calculates end if left blank.</div>
                </div>

                <div id="toggles-container" class="toggle-grid">
                    <!-- Dynamically rendered by app.js -->
                </div>

                <div id="run-summary" class="run-summary panel-soft mt-15">
                    <!-- Dynamic summary -->
                </div>

                <div class="text-center mt-4 flex-row flex-center gap-075 flex-wrap">
                    <button onclick="createJob()" class="voxel-btn primary">
                        Create Montage
                    </button>
                    <button onclick="createJob(true)" class="voxel-btn">
                        Quick Preview
                    </button>
                </div>
                <div class="text-center mt-4 flex-row flex-center gap-05 flex-wrap opacity-80">
                    <button onclick="savePreset()" class="voxel-btn small" title="Save current settings to browser">
                        Save Preset
                    </button>
                    <button onclick="clearPreset()" class="voxel-btn small" title="Clear saved preset">
                        Clear Preset
                    </button>
                </div>
            </section>

            <!-- Panel 4: Advanced & B-Roll -->
            <section class="voxel-card">
                <div class="section-heading">
                    <h2>ADVANCED // B-ROLL</h2>
                    <div class="badge warning">Optional</div>
                </div>
                <p class="helper">Semantic search helps find matching moments in your footage.</p>
                <div class="form-group">
                    <label for="brollQuery">Search Query</label>
                    <input type="text" id="brollQuery" class="voxel-input" placeholder="e.g., energetic action scene, golden hour wide shot">
                </div>
                <div class="text-center flex-row flex-center gap-05">
                    <button onclick="analyzeFootage()" class="voxel-btn">
                        ‚ü≥ Analyze Footage
                    </button>
                    <button onclick="searchBroll()" class="voxel-btn secondary">
                        üîç Search
                    </button>
                </div>
                <div id="brollResults" class="terminal-output hidden-block dashed-box mt-1"></div>
            </section>
        </div>

        <section class="job-status-container hidden-block" id="jobStatusSection">
            <div class="job-status-header">
                <span>> SYSTEM_MONITOR</span>
                <span id="clock">00:00:00</span>
            </div>
            
            <div class="status-grid">
                <div class="status-panel">
                    <h3>Current Job</h3>
                    <div id="currentJobStatus" class="job-card active">
                        <div class="job-header">
                            <span class="job-id">#INIT</span>
                            <span class="job-phase">WAITING</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar w-0"></div>
                        </div>
                        <div class="job-details">
                            Initializing system...
                        </div>
                    </div>
                </div>
                
                <div class="status-panel terminal-panel">
                    <h3>Live Logs</h3>
                    <div id="terminalOutput" class="terminal-window">
                        <div class="terminal-line"><span class="dim">System ready. Waiting for input...</span></div>
                    </div>
                </div>
            </div>

            <div class="timeline-viz" title="Processing Stream"></div>
        </section>

        <section class="voxel-card" id="gallerySection">
            <div class="section-heading">
                <h2>ARCHIVE // GALLERY</h2>
                <div class="badge">Recent Outputs</div>
            </div>
            <div id="jobList" class="gallery-grid">
                <!-- Populated by JS -->
            </div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        // Simple clock for the terminal header
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);
    </script>

    <!-- Decisions Modal -->
    <div id="decisionsModal" class="modal hidden-block">
        <div class="modal-overlay" onclick="closeDecisions()"></div>
        <div class="modal-content voxel-card">
            <div class="modal-header">
                <h2>// DIRECTOR_LOG</h2>
                <button onclick="closeDecisions()" class="voxel-btn small">CLOSE</button>
            </div>
            <div id="decisionsContent" class="modal-body terminal-window modal-body-scroll">
                <!-- Content injected here -->
            </div>
        </div>
    </div>
</body>
</html>
