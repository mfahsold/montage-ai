<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montage AI - Cyber Deck</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header / Console Top -->
        <header>
            <div class="logo-container">
                <svg class="logo-svg" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Film reel outer ring -->
                    <circle cx="32" cy="32" r="28" stroke="currentColor" stroke-width="4" fill="none"/>
                    <!-- Inner film holes -->
                    <circle cx="32" cy="14" r="4" fill="currentColor"/>
                    <circle cx="32" cy="50" r="4" fill="currentColor"/>
                    <circle cx="14" cy="32" r="4" fill="currentColor"/>
                    <circle cx="50" cy="32" r="4" fill="currentColor"/>
                    <!-- AI brain/circuit in center -->
                    <rect x="24" y="24" width="16" height="16" fill="currentColor"/>
                </svg>
                <div class="logo-text">
                    <h1>Montage<span class="logo-ai">AI</span></h1>
                    <p class="subtitle">// AUTOMATED_EDITING_SYSTEM // v{{ version }}</p>
                </div>
            </div>
            <div class="version-badge">SYS.READY</div>
        </header>

        <!-- Upload Section -->
        <section class="voxel-card">
            <h2>01 // MEDIA_INGEST</h2>
            <div class="upload-area">
                <div class="upload-box">
                    <h3>[ VIDEO_INPUT ]</h3>
                    <input type="file" id="videoUpload" accept="video/*" multiple class="hidden">
                    <button onclick="document.getElementById('videoUpload').click()" class="voxel-btn">Select Source Files</button>
                    <div id="videoList" class="file-list"></div>
                </div>
                <div class="upload-box">
                    <h3>[ AUDIO_TRACK ]</h3>
                    <input type="file" id="musicUpload" accept="audio/*" class="hidden">
                    <button onclick="document.getElementById('musicUpload').click()" class="voxel-btn">Select Audio Track</button>
                    <div id="musicList" class="file-list"></div>
                </div>
            </div>
            <div class="text-center">
                <button onclick="refreshFiles()" class="voxel-btn">‚ü≥ REFRESH_STREAMS</button>
            </div>
        </section>

        <!-- B-Roll Planning Section -->
        <section class="voxel-card">
            <h2>02 // BROLL_PLANNING [ OPTIONAL ]</h2>
            <p style="color: var(--text-dim); font-size: 0.9em; margin-bottom: 1rem; line-height: 1.4;">
                <strong style="color: var(--accent);">> FIND THE RIGHT CLIPS</strong><br>
                Search your footage by description. AI finds matching scenes.
            </p>
            <div class="form-group">
                <label for="brollQuery">SEARCH_QUERY</label>
                <input type="text" id="brollQuery" class="voxel-input" placeholder="> Describe what you need (e.g. 'energetic action scene')...">
            </div>
            <div class="text-center" style="display: flex; gap: 0.5rem; justify-content: center;">
                <button onclick="analyzeFoootage()" class="voxel-btn">
                    ‚ü≥ ANALYZE_FOOTAGE
                </button>
                <button onclick="searchBroll()" class="voxel-btn secondary">
                    üîç SEARCH
                </button>
            </div>
            <!-- Search Results -->
            <div id="brollResults" class="terminal-output" style="display: none; margin-top: 1rem; padding: 0.5rem; border: 1px dashed var(--text-dim);"></div>
        </section>

        <!-- Configuration Section -->
        <section class="voxel-card">
            <h2>03 // ASSEMBLE_FINAL_CUT [ MAIN PROCESS ]</h2>
            <p style="color: var(--text-dim); font-size: 0.9em; margin-bottom: 1rem; line-height: 1.4;">
                <strong style="color: var(--accent);">> READY TO EDIT?</strong><br>
                This process takes <em>ALL available clips</em> (your uploads + AI generated assets)<br>
                and edits them to the beat of the music to create the final video.
            </p>

            <div class="form-group">
                <label for="style">EDIT_STYLE_PRESET</label>
                <select id="style" class="voxel-select">
                    <option value="dynamic">[ DYNAMIC ] - Position-aware pacing</option>
                    <option value="hitchcock">[ HITCHCOCK ] - Suspense / Slow Build</option>
                    <option value="mtv">[ MTV ] - Rapid Fire Cuts</option>
                    <option value="action">[ ACTION ] - High Energy</option>
                    <option value="documentary">[ DOCU ] - Observational</option>
                    <option value="minimalist">[ MINIMAL ] - Long Takes</option>
                    <option value="wes_anderson">[ WES ] - Symmetric / Stylized</option>
                </select>
            </div>

            <div class="form-group">
                <label for="prompt">CREATIVE_DIRECTOR_PROMPT</label>
                <input type="text" id="prompt" class="voxel-input" placeholder="> Enter natural language instructions...">
            </div>

            <div class="form-group">
                <label>TARGET_DURATION: <span id="durationValue">Auto</span></label>
                <input type="range" id="targetDuration" min="0" max="300" step="10" value="0">
                <small style="font-family: monospace; color: var(--primary);">0 = Auto-match music length</small>
            </div>

            <div class="form-group">
                <label>MUSIC_TRIM (Seconds)</label>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="musicStart" style="font-size: 0.8em;">START</label>
                        <input type="number" id="musicStart" class="voxel-input" value="0" min="0" step="0.1">
                    </div>
                    <div style="flex: 1;">
                        <label for="musicEnd" style="font-size: 0.8em;">END (Optional)</label>
                        <input type="number" id="musicEnd" class="voxel-input" placeholder="Auto" min="0" step="0.1">
                    </div>
                </div>
            </div>

            <div class="checkbox-group">
                <label class="checkbox-item">
                    <input type="checkbox" id="stabilize" {% if defaults.stabilize %}checked{% endif %}>
                    <span>STABILIZE_FOOTAGE</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="upscale" {% if defaults.upscale %}checked{% endif %}>
                    <span>AI_UPSCALE (4K)</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="cgpu" {% if defaults.cgpu %}checked{% endif %}>
                    <span>CLOUD_GPU_OFFLOAD</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="llm_clip_selection" {% if defaults.llm_clip_selection %}checked{% endif %}>
                    <span>LLM_SCENE_ANALYSIS</span>
                </label>
            </div>

            <div class="text-center mt-4">
                <button onclick="createJob()" class="voxel-btn primary">
                    ‚ñ∂ EXECUTE_MONTAGE_SEQUENCE
                </button>
            </div>
        </section>

        <!-- Job Status / Terminal -->
        <section class="job-status-container">
            <div class="job-status-header">
                <span>> SYSTEM_MONITOR</span>
                <span id="clock">00:00:00</span>
            </div>
            <div id="jobList" class="job-list">
                <!-- Jobs injected here -->
                <div class="job-item">
                    <span>[WAITING]</span>
                    <span>System initialized. Ready for input.</span>
                </div>
            </div>
            <!-- The Unusual Element: Timeline Visualizer -->
            <div class="timeline-viz" title="Processing Stream"></div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        // Simple clock for the terminal header
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);
    </script>
</body>
</html>
